<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta tags for character encoding and viewport -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Dashboard - Real-Time Weather Information</title>
    
    <!-- Bootstrap CSS for responsive design -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    
    <!-- Custom CSS Styling -->
    <style>
        /* Main body styling with gradient background - Tortoise Blue */
        body {
            background: linear-gradient(135deg, #00a8a8 0%, #006f6f 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        /* Card styling - used for all data sections */
        .card {
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            background-color: rgba(255, 255, 255, 0.95);
            color: #333;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        /* Hover effect for cards */
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        }
        
        /* Card title styling */
        .card-title {
            font-weight: bold;
            color: #00a8a8;
        }
        
        /* Weather icon sizing */
        .weather-icon {
            width: 80px;
            height: 80px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }
        
        /* Current weather section - prominent display */
        .current-weather {
            background: linear-gradient(135deg, #00a8a8 0%, #006f6f 100%);
            color: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        
        /* Metric box for individual data points */
        .metric-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
            border: 2px solid #e9ecef;
        }
        
        /* Large metric values */
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #00a8a8;
        }
        
        /* Small metric labels */
        .metric-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        
        /* Forecast item styling - for hourly and daily items */
        .forecast-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin: 5px;
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
        }
        
        /* Hover effect for forecast items */
        .forecast-item:hover {
            background: #e9ecef;
            border-color: #667eea;
            transform: scale(1.05);
        }
        
        /* Forecast icon sizing */
        .forecast-icon {
            width: 50px;
            height: 50px;
        }
        
        /* Alert item styling - warnings and alerts */
        .alert-item {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        /* UV Index display */
        .uv-index {
            font-size: 28px;
            font-weight: bold;
        }
        
        /* UV Index color coding */
        .uv-low { color: #28a745; }      /* Green - Low risk */
        .uv-moderate { color: #ffc107; }  /* Yellow - Moderate risk */
        .uv-high { color: #fd7e14; }      /* Orange - High risk */
        .uv-very-high { color: #dc3545; } /* Red - Very High risk */
        
        /* Header time display styling */
        .header-time {
            color: white;
            font-size: 14px;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
        }
        
        .current-time {
            font-size: 28px;
            font-weight: bold;
            color: #00a8a8;
        }
        
        .current-date {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
            margin-top: 5px;
        }
        
        /* Last updated timestamp */
        .last-updated {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 20px;
            text-align: center;
        }
        
        /* Time display in weather card */
        .weather-timestamp {
            color: #666;
            font-size: 12px;
            margin-top: 10px;
            font-style: italic;
        }
        
        /* 24-hour clock toggle */
        .time-format-toggle {
            display: inline-block;
            margin-top: 10px;
        }
        
        .time-format-btn {
            background-color: transparent;
            color: #00a8a8;
            border: 1px solid #00a8a8;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .time-format-btn:hover {
            background-color: #00a8a8;
            color: white;
        }
        
        .time-format-btn.active {
            background-color: #00a8a8;
            color: white;
        }
        
        /* Sunrise/Sunset section */
        .sunrise-sunset-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #00a8a8;
        }
        
        .sunrise-sunset-row {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .sunrise-sunset-item {
            text-align: center;
            flex: 1;
            min-width: 150px;
        }
        
        .sunrise-sunset-item .label {
            font-size: 14px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        
        .sunrise-sunset-item .time {
            font-size: 24px;
            font-weight: bold;
            color: #00a8a8;
        }
        
        .sunrise-sunset-item .icon {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        /* Timezone display */
        .timezone-badge {
            display: inline-block;
            background: linear-gradient(135deg, #00a8a8 0%, #006f6f 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            margin-top: 10px;
        }
        
        /* Last updated badge */
        .last-updated-badge {
            background: #e7f3f3;
            color: #006f6f;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 12px;
            margin-top: 15px;
            text-align: center;
            border: 1px solid #00a8a8;
        }
        
        /* Section titles */
        .section-title {
            color: white;
            margin-top: 30px;
            margin-bottom: 20px;
            font-weight: bold;
            font-size: 24px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        /* Input field styling */
        .form-control {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 10px 15px;
            transition: border-color 0.3s ease;
        }
        
        /* Input field focus state */
        .form-control:focus {
            border-color: #00a8a8;
            box-shadow: 0 0 0 0.2rem rgba(0, 168, 168, 0.25);
        }
        
        /* Button styling */
        .btn-primary {
            background-color: #00a8a8;
            border-color: #00a8a8;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        /* Button hover effect */
        .btn-primary:hover {
            background-color: #006f6f;
            border-color: #006f6f;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        /* Responsive text sizing */
        @media (max-width: 768px) {
            .current-weather h1 {
                font-size: 36px !important;
            }
            .section-title {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <!-- Main container with padding -->
    <div class="container py-5">
        <!-- Page header -->
        <h1 class="text-white text-center mb-4">üå§Ô∏è Weather Dashboard</h1>
        
        <!-- Current time display -->
        <div class="header-time text-center">
            <div class="current-time" id="currentTime">
                {% if current_time %}
                    {{ current_time | format_time }}
                {% else %}
                    --:-- AM
                {% endif %}
            </div>
            <div class="current-date">
                {% if current_time %}
                    {{ current_time | format_date_long }}
                {% else %}
                    Loading date...
                {% endif %}
            </div>
            <!-- Time format toggle buttons -->
            <div class="time-format-toggle">
                <button class="time-format-btn active" onclick="toggleTimeFormat('12h')" id="btn-12h">12-hour</button>
                <button class="time-format-btn" onclick="toggleTimeFormat('24h')" id="btn-24h">24-hour</button>
            </div>
        </div>
        
        <!-- Search Form Section -->
        <div class="card mb-5">
            <div class="card-body">
                <!-- Form to get weather for a specific location -->
                <form action="/" method="POST">
                    <div class="row">
                        <!-- City input field -->
                        <div class="col-md-3 mb-3">
                            <input type="text" id="city" name="city" placeholder="City e.g., London" class="form-control" required>
                        </div>
                        <!-- State/Province input field -->
                        <div class="col-md-3 mb-3">
                            <input type="text" id="state" name="state" placeholder="State or state code e.g., England / 10" class="form-control">
                        </div>
                        <!-- Country code input field -->
                        <div class="col-md-3 mb-3">
                            <input type="text" id="country" name="country" placeholder="Country / country code e.g., GB" class="form-control">
                        </div>
                        <!-- Submit button -->
                        <div class="col-md-3 mb-3">
                            <button type="submit" class="btn btn-primary w-100">Get Weather</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Weather Data Display (shown only if data is available) -->
        {% if weather_data %}
            <!-- ========== CURRENT WEATHER SECTION ========== -->
            <!-- Displays main weather info: location, temperature, description, and weather icon -->
            <div class="current-weather">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <!-- Location name -->
                        <h2>{{ weather_data.name }}</h2>
                        <!-- Current temperature (prominently displayed) -->
                        <h1 style="font-size: 48px;">{{ weather_data.temperature }}¬∞C</h1>
                        <!-- Current weather description -->
                        <p style="font-size: 20px; text-transform: capitalize;">{{ weather_data.description }}</p>
                        <!-- "Feels like" temperature -->
                        <p>Feels like: {{ weather_data.feels_like }}¬∞C</p>
                    </div>
                    <div class="col-md-6 text-center">
                        <!-- Weather condition icon from OpenWeatherMap -->
                        <img src="http://openweathermap.org/img/wn/{{ weather_data.icon }}@4x.png" alt="{{ weather_data.description }}" class="weather-icon">
                    </div>
                </div>
            </div>

            <!-- ========== KEY METRICS SECTION ========== -->
            <!-- Displays important weather measurements: wind speed, visibility, humidity, pressure -->
            <div class="row mb-4">
                <!-- Wind Speed Card -->
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="metric-label">üí® Wind Speed</div>
                            <div class="metric-value">{{ "%.1f"|format(weather_data.wind_speed) }} m/s</div>
                            <small class="text-muted">{{ "%.1f"|format(weather_data.wind_speed * 3.6) }} km/h</small>
                        </div>
                    </div>
                </div>
                <!-- Visibility Card -->
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="metric-label">üëÅÔ∏è Visibility</div>
                            <div class="metric-value">{{ (weather_data.visibility / 1000)|int }} km</div>
                            <small class="text-muted">{{ weather_data.visibility }} m</small>
                        </div>
                    </div>
                </div>
                <!-- Humidity Card -->
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="metric-label">üíß Humidity</div>
                            <div class="metric-value">{{ weather_data.humidity }}%</div>
                        </div>
                    </div>
                </div>
                <!-- Pressure Card -->
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="metric-label">üìä Pressure</div>
                            <div class="metric-value">{{ weather_data.pressure }} mb</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========== SUNRISE/SUNSET SECTION ========== -->
            <!-- Shows sunrise and sunset times for the location -->
            <div class="sunrise-sunset-container">
                <div class="sunrise-sunset-row">
                    <!-- Sunrise -->
                    <div class="sunrise-sunset-item">
                        <div class="icon">üåÖ</div>
                        <div class="label">Sunrise</div>
                        <div class="time">{{ weather_data.sunrise | sunrise_sunset }}</div>
                    </div>
                    <!-- Sunset -->
                    <div class="sunrise-sunset-item">
                        <div class="icon">üåÖ</div>
                        <div class="label">Sunset</div>
                        <div class="time">{{ weather_data.sunset | sunrise_sunset }}</div>
                    </div>
                    <!-- Timezone -->
                    <div class="sunrise-sunset-item">
                        <div class="icon">üåç</div>
                        <div class="label">Location</div>
                        <div class="timezone-badge">{{ weather_data.timezone | timezone_display }}</div>
                    </div>
                </div>
                <!-- Last updated -->
                <div class="last-updated-badge">
                    ‚è±Ô∏è Last Updated: {{ weather_data.last_updated | time_ago }}
                </div>
            </div>

            <!-- ========== UV INDEX SECTION ========== -->
            <!-- Shows UV index value with color-coded risk level -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">‚òÄÔ∏è UV Index</h5>
                            <!-- UV Index value with dynamic color based on risk level -->
                            <div class="uv-index
                            {% if weather_data.uv_index <= 2 %}
                                uv-low
                            {% elif weather_data.uv_index <= 5 %}
                                uv-moderate
                            {% elif weather_data.uv_index <= 7 %}
                                uv-high
                            {% else %}
                                uv-very-high
                            {% endif %}
                            ">
                                {{ "%.1f"|format(weather_data.uv_index) }}
                            </div>
                            <!-- UV Index risk level advisory -->
                            <small class="text-muted">
                                {% if weather_data.uv_index <= 2 %}
                                    <strong style="color: #28a745;">Low</strong> - Wear sunscreen
                                {% elif weather_data.uv_index <= 5 %}
                                    <strong style="color: #ffc107;">Moderate</strong> - Use sunscreen
                                {% elif weather_data.uv_index <= 7 %}
                                    <strong style="color: #fd7e14;">High</strong> - Extra protection needed
                                {% else %}
                                    <strong style="color: #dc3545;">Very High</strong> - Avoid sun exposure
                                {% endif %}
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========== WEATHER ALERTS SECTION ========== -->
            <!-- Displays any active weather alerts or warnings (if available) -->
            {% if weather_data.alerts %}
                <h3 class="section-title">‚ö†Ô∏è Weather Alerts</h3>
                <div class="row mb-4">
                    <div class="col-md-12">
                        <!-- Loop through all active alerts -->
                        {% for alert in weather_data.alerts %}
                            <div class="alert-item">
                                <h5>{{ alert.event }}</h5>
                                <p>{{ alert.description }}</p>
                                <small class="text-muted">
                                    From: {{ alert.start | strftime('%Y-%m-%d %H:%M') }} | 
                                    To: {{ alert.end | strftime('%Y-%m-%d %H:%M') }}
                                </small>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}

            <!-- ========== 24-HOUR FORECAST SECTION ========== -->
            <!-- Shows hourly weather predictions for the next 24 hours -->
            <h3 class="section-title">üìä 24 Hour Forecast</h3>
            <div class="card mb-4">
                <div class="card-body">
                    <div class="row">
                        <!-- Loop through each hour in the forecast -->
                        {% for hour in weather_data.hourly_forecast %}
                            <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                                <div class="forecast-item">
                                    <!-- Hour time -->
                                    <small><strong>{{ hour.time | strftime('%H:%M') }}</strong></small>
                                    <!-- Weather icon for this hour -->
                                    <img src="http://openweathermap.org/img/wn/{{ hour.icon }}.png" alt="{{ hour.description }}" class="forecast-icon">
                                    <!-- Temperature for this hour -->
                                    <div class="metric-value">{{ "%.0f"|format(hour.temp) }}¬∞C</div>
                                    <!-- Chance of precipitation -->
                                    <small class="text-muted">{{ hour.precipitation | int }}% rain</small>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- ========== 5-7 DAY FORECAST SECTION ========== -->
            <!-- Shows daily weather predictions for the next 5-7 days -->
            <h3 class="section-title">üìÖ 5 Day Forecast</h3>
            <div class="card mb-4">
                <div class="card-body">
                    <div class="row">
                        <!-- Loop through each day in the forecast -->
                        {% for day in weather_data.daily_forecast %}
                            <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                                <div class="forecast-item">
                                    <!-- Day of week and date -->
                                    <small><strong>{{ day.time | strftime('%a, %b %d') }}</strong></small>
                                    <!-- Weather icon for this day -->
                                    <img src="http://openweathermap.org/img/wn/{{ day.icon }}.png" alt="{{ day.description }}" class="forecast-icon">
                                    <!-- High and Low temperatures -->
                                    <div style="font-size: 16px; font-weight: bold;">
                                        <span style="color: #667eea;">{{ "%.0f"|format(day.temp_max) }}¬∞</span> / 
                                        <span style="color: #999;">{{ "%.0f"|format(day.temp_min) }}¬∞</span>
                                    </div>
                                    <!-- Humidity percentage -->
                                    <small class="text-muted">üíß {{ day.humidity }}%</small><br>
                                    <!-- Wind speed -->
                                    <small class="text-muted">üí® {{ "%.1f"|format(day.wind_speed) }} m/s</small>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        {% else %}
            <!-- Display message when no weather data has been fetched yet -->
            <div class="card">
                <div class="card-body text-center">
                    <p class="text-muted">Enter a city name to get weather information</p>
                </div>
            </div>
        {% endif %}
    </div>

    <!-- Bootstrap JavaScript Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-5sE5c5F5s5E5c5F5s5E5c5F5s5E5c5F5s5E5c5F5s5E5c5F5s5E5c5F5s5E5c5F5" crossorigin="anonymous"></script>
    
    <!-- Custom JavaScript for time and date formatting -->
    <script>
        // Track current time format (12h or 24h)
        let currentTimeFormat = '12h';
        
        // Update current time every second
        function updateCurrentTime() {
            const now = new Date();
            const timeElement = document.getElementById('currentTime');
            
            if (timeElement) {
                if (currentTimeFormat === '12h') {
                    // 12-hour format with AM/PM
                    const hours = now.getHours() % 12 || 12;
                    const minutes = String(now.getMinutes()).padStart(2, '0');
                    const ampm = now.getHours() >= 12 ? 'PM' : 'AM';
                    timeElement.textContent = `${hours}:${minutes} ${ampm}`;
                } else {
                    // 24-hour format
                    const hours = String(now.getHours()).padStart(2, '0');
                    const minutes = String(now.getMinutes()).padStart(2, '0');
                    timeElement.textContent = `${hours}:${minutes}`;
                }
            }
        }
        
        // Toggle between 12-hour and 24-hour time format
        function toggleTimeFormat(format) {
            currentTimeFormat = format;
            
            // Update button styles
            document.getElementById('btn-12h').classList.toggle('active', format === '12h');
            document.getElementById('btn-24h').classList.toggle('active', format === '24h');
            
            // Update the displayed time
            updateCurrentTime();
            
            // Save preference to localStorage
            localStorage.setItem('timeFormat', format);
        }
        
        // Load saved time format preference
        function loadTimeFormatPreference() {
            const saved = localStorage.getItem('timeFormat');
            if (saved) {
                currentTimeFormat = saved;
                document.getElementById('btn-12h').classList.toggle('active', saved === '12h');
                document.getElementById('btn-24h').classList.toggle('active', saved === '24h');
            }
        }
        
        // Initialize time display when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadTimeFormatPreference();
            updateCurrentTime();
            // Update time every second
            setInterval(updateCurrentTime, 1000);
        });
        
        // Add timestamp filter for Jinja2 - converts Unix timestamps to readable dates
        Jinja2.filters.strftime = function(timestamp, format) {
            const date = new Date(timestamp * 1000);
            const options = {};
            if (format.includes('%a')) options.weekday = 'short';
            if (format.includes('%d')) options.day = '2-digit';
            if (format.includes('%b')) options.month = 'short';
            if (format.includes('%H:%M')) {
                options.hour = '2-digit';
                options.minute = '2-digit';
            }
            return date.toLocaleDateString('en-US', options);
        };
    </script>
</body>
</html>